<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord d'Optimisation de Flotte</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Arial', sans-serif; /* Changed to Inter, fallback to Arial */
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        .container {
            min-height: 100vh;
            position: relative;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            top: 50%; /* Centering for rotation */
            left: 50%; /* Centering for rotation */
            transform-origin: center center; /* Ensure rotation is around the center */
            background: radial-gradient(circle at 20% 50%, rgba(0, 255, 255, 0.08) 0%, transparent 40%), /* Adjusted alpha and size */
                        radial-gradient(circle at 80% 20%, rgba(255, 0, 150, 0.08) 0%, transparent 40%),
                        radial-gradient(circle at 40% 80%, rgba(0, 255, 100, 0.08) 0%, transparent 40%);
            animation: float 25s ease-in-out infinite; /* Slightly slower animation */
        }

        @keyframes float {
            0% { transform: translate(-50%, -50%) rotate(0deg) scale(1); }
            50% { transform: translate(-50%, -50%) rotate(180deg) scale(1.1); }
            100% { transform: translate(-50%, -50%) rotate(360deg) scale(1); }
        }

        /* Navigation */
        .nav {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(30, 30, 50, 0.6); /* Darker, more subtle background */
            backdrop-filter: blur(15px); /* Increased blur */
            border-radius: 50px;
            padding: 8px 15px; /* Adjusted padding */
            border: 1px solid rgba(255, 255, 255, 0.15); /* Slightly more visible border */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3); /* Softer shadow */
        }

        .nav-item {
            display: inline-block;
            padding: 10px 18px; /* Adjusted padding */
            margin: 0 5px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.9rem; /* Slightly smaller font for nav items */
            position: relative;
            overflow: hidden;
            color: #e0e0e0; /* Lighter text color for non-active items */
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.15); /* Slightly more opaque hover */
            transform: translateY(-2px);
            color: #ffffff;
        }

        .nav-item.active {
            background: linear-gradient(135deg, #00c6ff, #0072ff); /* Adjusted gradient */
            color: #ffffff; /* White text on active for better contrast */
            box-shadow: 0 5px 15px rgba(0, 198, 255, 0.4); /* Adjusted shadow */
        }

        /* Page Content */
        .page {
            display: none;
            padding: 120px 40px 40px; /* Increased top padding */
            animation: fadeIn 0.7s ease-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); } /* Softer entry */
            to { opacity: 1; transform: translateY(0); }
        }

        .page-title {
            text-align: center;
            font-size: 2.8rem; /* Slightly adjusted size */
            margin-bottom: 50px;
            font-weight: 600; /* Added font weight */
            background: linear-gradient(135deg, #00ffff, #ff00aa, #00ff88); /* Adjusted gradient */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.4); /* Softer glow */
            animation: glow 2.5s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: brightness(1); text-shadow: 0 0 20px rgba(0, 255, 255, 0.4); }
            to { filter: brightness(1.3); text-shadow: 0 0 30px rgba(0, 255, 255, 0.6), 0 0 10px rgba(255, 0, 170, 0.3); }
        }

        /* Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); /* Adjusted minmax */
            gap: 25px; /* Adjusted gap */
            margin-bottom: 40px;
        }

        .card {
            background: rgba(35, 35, 60, 0.5); /* Darker card background */
            backdrop-filter: blur(15px);
            border-radius: 15px; /* Slightly smaller radius */
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25); /* Softer shadow */
            transition: all 0.35s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -150%; /* Start further left */
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.08), transparent); /* Subtler shine */
            transition: left 0.6s ease-out; /* Smoother transition */
        }

        .card:hover::before {
            left: 150%; /* Move further right */
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02); /* Added slight scale */
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.35);
            border-color: rgba(0, 220, 255, 0.6); /* Brighter hover border */
        }

        .card-title {
            font-size: 1.4rem; /* Adjusted size */
            margin-bottom: 18px;
            color: #00d4ff; /* Brighter title color */
            font-weight: 500;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            height: 350px; /* Adjusted height */
            margin-bottom: 20px; /* Adjusted margin */
        }

        .chart-container canvas {
            border-radius: 10px; /* Smaller radius for canvas */
        }

        /* Metrics Cards */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* Adjusted minmax */
            gap: 20px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: rgba(40, 40, 70, 0.5); /* Darker metric card */
            backdrop-filter: blur(12px);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.12);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px; /* Thicker line */
            background: linear-gradient(90deg, #00c6ff, #0072ff, #00ffaa); /* Adjusted gradient */
            border-radius: 12px 12px 0 0;
            opacity: 0.8;
        }

        .metric-card:hover {
            transform: scale(1.03); /* Slightly less scale */
            box-shadow: 0 10px 25px rgba(0, 198, 255, 0.25); /* Softer shadow */
        }

        .metric-value {
            font-size: 2.2rem; /* Adjusted size */
            font-weight: 600; /* Bolder */
            margin-bottom: 8px;
            background: linear-gradient(135deg, #00e1ff, #f0f0f0); /* Adjusted gradient */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-label {
            color: #b0b0c0; /* Lighter gray */
            font-size: 0.9rem;
        }

        .metric-change {
            font-size: 0.85rem;
            margin-top: 8px;
            padding: 4px 10px;
            border-radius: 15px;
            display: inline-block;
            font-weight: 500;
        }

        .metric-change.positive {
            background: rgba(0, 255, 120, 0.15);
            color: #00ff78;
        }

        .metric-change.negative {
            background: rgba(255, 60, 100, 0.15);
            color: #ff3c64;
        }

        /* Comparison Table */
        .comparison-table {
            background: rgba(35, 35, 60, 0.4); /* Darker table background */
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .comparison-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px 15px; /* Adjusted padding */
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08); /* Subtler border */
            font-size: 0.9rem;
        }

        .comparison-table th {
            background: rgba(0, 198, 255, 0.1); /* Header background */
            color: #00c6ff;
            font-weight: 600; /* Bolder headers */
            text-transform: uppercase; /* Uppercase headers */
            letter-spacing: 0.5px;
        }
        .comparison-table td:nth-child(1) { /* Style first column for metric names */
            font-weight: 500;
            color: #e0e0e0;
        }

        .comparison-table tr:hover {
            background: rgba(255, 255, 255, 0.03); /* Very subtle hover */
        }
        .comparison-table tr:last-child td {
            border-bottom: none; /* Remove border for last row */
        }

        /* Loading Animation */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 150px; /* Reduced height */
            width: 100%;
        }

        .loading-spinner {
            width: 40px; /* Smaller spinner */
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.2); /* Thicker border, more contrast */
            border-top: 4px solid #00c6ff; /* Brighter color */
            border-radius: 50%;
            animation: spin 0.8s linear infinite; /* Faster spin */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Custom Scrollbar for Webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(0, 198, 255, 0.5);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 198, 255, 0.7);
        }


        /* Responsive */
        @media (max-width: 992px) { /* Tablet and below */
            .card-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            .page-title {
                font-size: 2.4rem;
            }
             .chart-container {
                height: 320px;
            }
        }

        @media (max-width: 768px) { /* Mobile */
            .page {
                padding: 100px 20px 20px;
            }
            
            .page-title {
                font-size: 2rem;
                margin-bottom: 30px;
            }
            
            .nav {
                padding: 8px 10px; /* Adjusted padding */
                width: 90%; /* Make nav take more width */
            }
            
            .nav-item {
                padding: 8px 12px; /* Smaller padding for nav items */
                margin: 0 2px;
                font-size: 0.8rem; /* Smaller font for nav items */
            }
            .card-grid {
                grid-template-columns: 1fr; /* Single column for cards */
                gap: 20px;
            }
            .metrics-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Smaller metrics cards */
                gap: 15px;
            }
            .metric-value {
                font-size: 1.8rem;
            }
            .metric-label {
                font-size: 0.8rem;
            }
            .chart-container {
                height: 300px;
            }
            .comparison-table th, .comparison-table td {
                padding: 10px 8px;
                font-size: 0.85rem;
            }
        }
         @media (max-width: 480px) { /* Small Mobile */
            .page-title {
                font-size: 1.8rem;
            }
            .nav-item {
                padding: 6px 8px;
                font-size: 0.75rem;
            }
            .metric-value {
                font-size: 1.6rem;
            }
             .chart-container {
                height: 280px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    
    <nav class="nav">
        <div class="nav-item active" onclick="navigateToPage('overview', this)">Aperçu</div>
        <div class="nav-item" onclick="navigateToPage('performance', this)">Performance</div>
        <div class="nav-item" onclick="navigateToPage('efficiency', this)">Efficacité</div> <!-- Corrected class attribute -->
        <div class="nav-item" onclick="navigateToPage('projections', this)">Projections</div>
        <div class="nav-item" onclick="navigateToPage('analysis', this)">Analyse</div>
    </nav>

    <div class="container">
        <!-- Page 1: Overview -->
        <div id="overview" class="page active">
            <h1 class="page-title">Aperçu de l'Optimisation Logistique</h1>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="totalTrips">0</div>
                    <div class="metric-label">Nombre d'opérations par jour</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avgDistance">-</div>
                    <div class="metric-label">Distance Quotidienne parcourue (moyenne) </div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="totalSavings">-</div>
                    <div class="metric-label">Réduction coût par jour (TND)</div>
                    <div class="metric-change positive" id="savingsChange">-</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="co2Reduction">-</div>
                    <div class="metric-label">Réduction CO₂ par jour</div>
                    <div class="metric-change positive" id="co2Change">-</div>
                </div>
            </div>

            <div class="card-grid">
                <div class="card">
                    <h3 class="card-title">Comparaison des Distances (par trajet)</h3>
                    <div class="chart-container">
                        <canvas id="distanceChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title">Comparaison Globale des Coûts</h3>
                    <div class="chart-container">
                        <canvas id="costChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page 2: Performance -->
        <div id="performance" class="page">
            <h1 class="page-title">Indicateurs de Performance</h1>
            
            <div class="card-grid">
                <div class="card">
                    <h3 class="card-title">Efficacité Temporelle (par trajet)</h3>
                    <div class="chart-container">
                        <canvas id="timeChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title">Consommation Globale de Carburant</h3>
                    <div class="chart-container">
                        <canvas id="fuelChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Tableau Comparatif des Performances</h3>
                <div class="comparison-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Indicateur</th>
                                <th>Ancien Système</th>
                                <th>Système Optimisé</th>
                                <th>Amélioration</th>
                                <th>% Variation</th>
                            </tr>
                        </thead>
                        <tbody id="performanceTableBody">
                             <tr><td colspan="5" class="loading"><div class="loading-spinner"></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Page 3: Efficiency -->
        <div id="efficiency" class="page">
            <h1 class="page-title">Analyse d'Efficacité</h1>
            
            <div class="card-grid">
                <div class="card">
                    <h3 class="card-title">Émissions de CO₂ (par trajet)</h3>
                    <div class="chart-container">
                        <canvas id="co2Chart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title">Radar d'Efficacité (Moyennes Normalisées)</h3>
                    <div class="chart-container">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
            </div>
             <div class="card">
                <h3 class="card-title">Coût par Kilomètre (par trajet)</h3>
                <div class="chart-container">
                    <canvas id="costPerKmChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Page 4: Projections -->
        <div id="projections" class="page">
            <h1 class="page-title">Projections Futures</h1>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="weeklyProjection">-</div>
                    <div class="metric-label">Écon. Hebdomadaires Est.</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="monthlyProjection">-</div>
                    <div class="metric-label">Écon. Mensuelles Est.</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="yearlyProjection">-</div>
                    <div class="metric-label">Écon. Annuelles Est.</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="monthlyCO2Projection">-</div>
                    <div class="metric-label">CO₂ Économisé Mensuel Est.</div>
                </div>
                 <div class="metric-card">
                    <div class="metric-value" id="yearlyCO2Projection">-</div>
                    <div class="metric-label">CO₂ Économisé Annuel Est.</div>
                </div>
            </div>

            <div class="card-grid">
                <div class="card">
                    <h3 class="card-title">Projections des Coûts Cumulés</h3>
                    <div class="chart-container">
                        <canvas id="projectionChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title">Impact Environnemental Projeté (Écon. CO₂)</h3>
                    <div class="chart-container">
                        <canvas id="environmentChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page 5: Analysis -->
        <div id="analysis" class="page">
            <h1 class="page-title">Analyse Détaillée</h1>
            <div class="card-grid">
                <div class="card">
                    <h3 class="card-title">Distribution des Distances de Trajet</h3>
                    <div class="chart-container">
                        <canvas id="distributionChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3 class="card-title">Tendance : Économies de Coût par Trajet</h3>
                    <div class="chart-container">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CSV Data (embedded) - Kept as is, assuming data format doesn't change with language.
        const oldDataCSV = `Date,distance(m),time (s),time (m),gpl,kgco2,cost
14/04/2025,204,612,10.2,0.51,0.74,0.48
14/04/2025,214,642,10.7,0.535,0.78,0.51
14/04/2025,242,726,12.1,0.605,0.88,0.57
14/04/2025,328,984,16.4,0.82,1.19,0.78
14/04/2025,350,1050,17.5,0.875,1.27,0.83
14/04/2025,125,375,6.25,0.312,0.45,0.3
14/04/2025,130,390,6.5,0.325,0.47,0.31
14/04/2025,132,396,6.6,0.33,0.48,0.31
14/04/2025,189,567,9.45,0.472,0.68,0.45
14/04/2025,195,585,9.75,0.487,0.71,0.46
14/04/2025,792,2376,39.6,1.98,2.87,1.88
14/04/2025,854,2562,42.7,2.135,3.1,2.03
14/04/2025,858,2574,42.9,2.145,3.11,2.04
14/04/2025,859,2577,42.95,2.147,3.11,2.04
14/04/2025,1013,3039,50.65,2.533,3.67,2.4
14/04/2025,381,1143,19.05,0.953,1.38,0.9
14/04/2025,532,1596,26.6,1.33,1.93,1.26
14/04/2025,658,1974,32.9,1.645,2.39,1.56
14/04/2025,704,2112,35.2,1.76,2.55,1.67
14/04/2025,754,2262,37.7,1.885,2.73,1.79
`;

        const optimizedDataCSV = `Date,distance(m),time (s),time (m),gpl,kgco2,cost
14/04/2025,185,555,9.25,0.463,0.67,0.44
14/04/2025,187,561,9.35,0.468,0.68,0.44
14/04/2025,220,660,11,0.55,0.8,0.52
14/04/2025,305,915,15.25,0.762,1.1,0.72
14/04/2025,298,894,14.9,0.745,1.08,0.71
14/04/2025,109,327,5.45,0.273,0.4,0.26
14/04/2025,117,351,5.85,0.292,0.42,0.28
14/04/2025,113,339,5.65,0.282,0.41,0.27
14/04/2025,164,492,8.2,0.41,0.59,0.39
14/04/2025,178,534,8.9,0.445,0.65,0.42
14/04/2025,700,2100,35,1.75,2.54,1.66
14/04/2025,734,2202,36.7,1.835,2.66,1.74
14/04/2025,738,2214,36.9,1.845,2.68,1.75
14/04/2025,803,2409,40.15,2.007,2.91,1.9
14/04/2025,922,2766,46.1,2.305,3.34,2.19
14/04/2025,355,1065,17.75,0.887,1.29,0.84
14/04/2025,489,1467,24.45,1.222,1.77,1.16
14/04/2025,582,1746,29.1,1.455,2.11,1.38
14/04/2025,609,1827,30.45,1.522,2.21,1.44
14/04/2025,713,2139,35.65,1.782,2.58,1.69
`;

        let oldDataParsed = [];
        let optimizedDataParsed = [];
        let oldMetrics = {};
        let optimizedMetrics = {};
        const tripLabels = Array.from({length: 20}, (_, i) => `Trajet ${i + 1}`);


        // Parse CSV data
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            if (lines.length <= 1) return []; 
            const headers = lines[0].split(',').map(h => h.trim());
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                const row = {};
                headers.forEach((header, index) => {
                    const value = values[index] ? values[index].trim() : '';
                    if (header === 'Date') {
                        row[header] = value;
                    } else {
                        row[header] = parseFloat(value);
                        if (isNaN(row[header])) {
                            console.warn(`Analyse CSV : Impossible d'analyser '${value}' pour l'en-tête '${header}' à la ligne ${i+1}. Valeur par défaut 0.`);
                            row[header] = 0;
                        }
                    }
                });
                data.push(row);
            }
            return data;
        }

        // Calculate metrics
        function calculateMetrics(data) {
            if (!data || data.length === 0) {
                return { count: 0, avgDistance: 0, avgTime: 0, totalFuel: 0, totalCO2: 0, totalCost: 0, avgCost: 0 };
            }
            const totalDistance = data.reduce((sum, row) => sum + (row['distance(m)'] || 0), 0);
            const totalTime = data.reduce((sum, row) => sum + (row['time (s)'] || 0), 0);
            const totalFuel = data.reduce((sum, row) => sum + (row.gpl || 0), 0);
            const totalCO2 = data.reduce((sum, row) => sum + (row.kgco2 || 0), 0);
            const totalCost = data.reduce((sum, row) => sum + (row.cost || 0), 0);
            
            return {
                count: data.length,
                totalDistance,
                totalTime,
                avgDistance: totalDistance / data.length,
                avgTime: totalTime / data.length,
                totalFuel,
                totalCO2,
                totalCost,
                avgCost: totalCost / data.length
            };
        }

        // Update overview metrics on the DOM
        function updateOverviewMetrics() {
            document.getElementById('totalTrips').textContent = optimizedDataParsed.length > 0 ? optimizedDataParsed.length : (oldDataParsed.length > 0 ? oldDataParsed.length : 'N/A');
            
            if (optimizedMetrics.count > 0) {
                document.getElementById('avgDistance').textContent = Math.round(optimizedMetrics.avgDistance);
            } else {
                 document.getElementById('avgDistance').textContent = 'N/A';
            }

            if (oldMetrics.count > 0 && optimizedMetrics.count > 0) {
                const totalSavings = oldMetrics.totalCost - optimizedMetrics.totalCost;
                const co2Reduction = oldMetrics.totalCO2 - optimizedMetrics.totalCO2;
                const savingsPercent = oldMetrics.totalCost !== 0 ? ((totalSavings / oldMetrics.totalCost) * 100) : 0;
                const co2Percent = oldMetrics.totalCO2 !== 0 ? ((co2Reduction / oldMetrics.totalCO2) * 100) : 0;

                document.getElementById('totalSavings').textContent = `${totalSavings.toFixed(2)} TND`;
                document.getElementById('co2Reduction').textContent = `${co2Reduction.toFixed(2)}kg`;
                
                const savingsChangeEl = document.getElementById('savingsChange');
                savingsChangeEl.textContent = `${savingsPercent.toFixed(1)}% ${totalSavings >= 0 ? 'économisé' : 'augmentation'}`;
                savingsChangeEl.className = `metric-change ${totalSavings >= 0 ? 'positive' : 'negative'}`;


                const co2ChangeEl = document.getElementById('co2Change');
                co2ChangeEl.textContent = `${co2Percent.toFixed(1)}% ${co2Reduction >= 0 ? 'réduit' : 'augmentation'}`;
                co2ChangeEl.className = `metric-change ${co2Reduction >= 0 ? 'positive' : 'negative'}`;

            } else {
                document.getElementById('totalSavings').textContent = 'N/A';
                document.getElementById('co2Reduction').textContent = 'N/A';
                document.getElementById('savingsChange').textContent = '-';
                document.getElementById('co2Change').textContent = '-';
            }
        }

        // Navigation
        function navigateToPage(pageId, navElement) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            } else {
                console.error("Page non trouvée : " + pageId);
                document.getElementById('overview').classList.add('active'); 
                document.querySelector('.nav-item[onclick*="overview"]').classList.add('active');
                return;
            }
            
            if (navElement && typeof navElement.classList !== 'undefined') { 
                 navElement.classList.add('active');
            } else {
                const fallbackNavElement = Array.from(document.querySelectorAll('.nav-item')).find(el => el.textContent.toLowerCase() === pageId.toLowerCase());
                if (fallbackNavElement) fallbackNavElement.classList.add('active');
            }
        }


        // Chart configurations
        const defaultChartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { 
                mode: 'index',
                intersect: false,
            },
            plugins: {
                legend: {
                    labels: {
                        color: '#e0e0e0', 
                        font: { size: 13, family: 'Inter, Arial, sans-serif' }
                    },
                    position: 'top', 
                },
                tooltip: { 
                    backgroundColor: 'rgba(0,0,0,0.7)',
                    titleFont: { size: 14, family: 'Inter, Arial, sans-serif', weight: 'bold' },
                    bodyFont: { size: 12, family: 'Inter, Arial, sans-serif' },
                    padding: 10,
                    cornerRadius: 5,
                    displayColors: true, 
                }
            },
            scales: {
                x: {
                    ticks: { color: '#b0b0c0', font: { family: 'Inter, Arial, sans-serif' } }, 
                    grid: { color: 'rgba(255, 255, 255, 0.08)' } 
                },
                y: {
                    ticks: { color: '#b0b0c0', font: { family: 'Inter, Arial, sans-serif' } },
                    grid: { color: 'rgba(255, 255, 255, 0.08)' },
                    beginAtZero: true
                }
            },
            animation: { 
                duration: 800,
                easing: 'easeInOutQuart'
            }
        };
        
        const doughnutRadarChartOptions = { 
             responsive: true,
             maintainAspectRatio: false,
             plugins: {
                 legend: {
                     labels: { color: '#e0e0e0', font: { size: 13, family: 'Inter, Arial, sans-serif' } },
                     position: 'top',
                 },
                tooltip: defaultChartOptions.plugins.tooltip
             },
             animation: defaultChartOptions.animation
        };


        // Create charts
        function createCharts() {
            if (oldDataParsed.length === 0 && optimizedDataParsed.length === 0) {
                console.warn("Aucune donnée disponible pour créer les graphiques.");
                document.querySelectorAll('.chart-container').forEach(container => {
                    container.innerHTML = '<p style="text-align:center; padding-top: 50px; color: #aaa;">Aucune donnée pour afficher le graphique.</p>';
                });
                return;
            }
            const commonTripLabels = tripLabels.slice(0, Math.max(oldDataParsed.length, optimizedDataParsed.length));

            // Distance Comparison Chart
            const distanceCtx = document.getElementById('distanceChart')?.getContext('2d');
            if (distanceCtx) new Chart(distanceCtx, {
                type: 'line',
                data: {
                    labels: commonTripLabels,
                    datasets: [{
                        label: 'Distance Ancien Système (m)',
                        data: oldDataParsed.map(row => row['distance(m)']),
                        borderColor: '#ff4081', 
                        backgroundColor: 'rgba(255, 64, 129, 0.15)',
                        tension: 0.3,
                        pointBackgroundColor: '#ff4081',
                        pointBorderColor: '#fff',
                        pointHoverRadius: 7,
                        fill: true,
                    }, {
                        label: 'Distance Système Optimisé (m)',
                        data: optimizedDataParsed.map(row => row['distance(m)']),
                        borderColor: '#00bcd4', 
                        backgroundColor: 'rgba(0, 188, 212, 0.15)',
                        tension: 0.3,
                        pointBackgroundColor: '#00bcd4',
                        pointBorderColor: '#fff',
                        pointHoverRadius: 7,
                        fill: true,
                    }]
                },
                options: defaultChartOptions
            });

            // Cost Comparison Chart
            const costCtx = document.getElementById('costChart')?.getContext('2d');
             if (costCtx) new Chart(costCtx, {
                type: 'bar',
                data: {
                    labels: ['Coût Total Ancien Système', 'Coût Total Système Optimisé'],
                    datasets: [{
                        label: 'Coût Total (TND)',
                        data: [oldMetrics.totalCost, optimizedMetrics.totalCost],
                        backgroundColor: ['rgba(255, 64, 129, 0.7)', 'rgba(0, 188, 212, 0.7)'],
                        borderColor: ['#ff4081', '#00bcd4'],
                        borderWidth: 2,
                        borderRadius: 5, 
                    }]
                },
                options: {...defaultChartOptions, scales: {...defaultChartOptions.scales, x: { grid: { display: false } } } } 
            });

            // Time Efficiency Chart
            const timeCtx = document.getElementById('timeChart')?.getContext('2d');
            if (timeCtx) new Chart(timeCtx, {
                type: 'line',
                data: {
                    labels: commonTripLabels,
                    datasets: [{
                        label: 'Temps Ancien Système (min)',
                        data: oldDataParsed.map(row => row['time (m)']),
                        borderColor: '#ff9800', 
                        backgroundColor: 'rgba(255, 152, 0, 0.15)',
                        tension: 0.3,
                        fill: true,
                    }, {
                        label: 'Temps Système Optimisé (min)',
                        data: optimizedDataParsed.map(row => row['time (m)']),
                        borderColor: '#4caf50', 
                        backgroundColor: 'rgba(76, 175, 80, 0.15)',
                        tension: 0.3,
                        fill: true,
                    }]
                },
                options: defaultChartOptions
            });

            // Fuel Consumption Chart
            const fuelCtx = document.getElementById('fuelChart')?.getContext('2d');
            if (fuelCtx) new Chart(fuelCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Carburant Total Ancien Système (gpl)', 'Carburant Total Système Optimisé (gpl)'],
                    datasets: [{
                        data: [oldMetrics.totalFuel, optimizedMetrics.totalFuel],
                        backgroundColor: ['rgba(255, 152, 0, 0.8)', 'rgba(76, 175, 80, 0.8)'],
                        borderColor: ['#ff9800', '#4caf50'],
                        borderWidth: 2,
                        hoverOffset: 8 
                    }]
                },
                options: {...doughnutRadarChartOptions, cutout: '60%' } 
            });

            // CO2 Emissions Chart
            const co2Ctx = document.getElementById('co2Chart')?.getContext('2d');
            if (co2Ctx) new Chart(co2Ctx, {
                type: 'line', 
                data: {
                    labels: commonTripLabels,
                    datasets: [{
                        label: 'CO₂ Ancien Système (kg)',
                        data: oldDataParsed.map(row => row.kgco2),
                        borderColor: '#f44336', 
                        backgroundColor: 'rgba(244, 67, 54, 0.2)',
                        fill: true,
                        tension: 0.3
                    }, {
                        label: 'CO₂ Système Optimisé (kg)',
                        data: optimizedDataParsed.map(row => row.kgco2),
                        borderColor: '#03a9f4', 
                        backgroundColor: 'rgba(3, 169, 244, 0.2)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: defaultChartOptions
            });

            // Radar Chart
            const radarCtx = document.getElementById('radarChart')?.getContext('2d');
            if (radarCtx) {
                const maxDist = Math.max(oldMetrics.avgDistance, optimizedMetrics.avgDistance, 1) * 1.1;
                const maxTime = Math.max(oldMetrics.avgTime, optimizedMetrics.avgTime, 1) * 1.1;
                const maxFuelCost = Math.max(oldMetrics.avgCost, optimizedMetrics.avgCost, 1) * 1.1; 
                const maxCO2 = Math.max(oldMetrics.totalCO2/(oldMetrics.count || 1), optimizedMetrics.totalCO2/(optimizedMetrics.count || 1), 1) * 1.1; 
                const maxTripCost = Math.max(oldMetrics.avgCost, optimizedMetrics.avgCost, 1) * 1.1;

                new Chart(radarCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Dist. Moy.', 'Temps Moy.', 'Coût Carb. Moy.', 'CO₂ Moy.', 'Coût Trajet Moy.'],
                        datasets: [{
                            label: 'Ancien Sys. (Moy. Norm.)',
                            data: [
                                oldMetrics.count > 0 ? (oldMetrics.avgDistance / maxDist) * 100 : 0,
                                oldMetrics.count > 0 ? (oldMetrics.avgTime / maxTime) * 100 : 0,
                                oldMetrics.count > 0 ? (oldMetrics.avgCost / maxFuelCost) * 100 : 0, 
                                oldMetrics.count > 0 ? ((oldMetrics.totalCO2/oldMetrics.count) / maxCO2) * 100 : 0,
                                oldMetrics.count > 0 ? (oldMetrics.avgCost / maxTripCost) * 100 : 0
                            ],
                            borderColor: '#ff4081',
                            backgroundColor: 'rgba(255, 64, 129, 0.25)',
                            pointBackgroundColor: '#ff4081',
                            pointBorderColor: '#fff',
                            pointHoverRadius: 6,
                        }, {
                            label: 'Sys. Optimisé (Moy. Norm.)',
                            data: [
                                optimizedMetrics.count > 0 ? (optimizedMetrics.avgDistance / maxDist) * 100 : 0,
                                optimizedMetrics.count > 0 ? (optimizedMetrics.avgTime / maxTime) * 100 : 0,
                                optimizedMetrics.count > 0 ? (optimizedMetrics.avgCost / maxFuelCost) * 100 : 0,
                                optimizedMetrics.count > 0 ? ((optimizedMetrics.totalCO2/optimizedMetrics.count) / maxCO2) * 100 : 0,
                                optimizedMetrics.count > 0 ? (optimizedMetrics.avgCost / maxTripCost) * 100 : 0
                            ],
                            borderColor: '#00bcd4',
                            backgroundColor: 'rgba(0, 188, 212, 0.25)',
                            pointBackgroundColor: '#00bcd4',
                            pointBorderColor: '#fff',
                            pointHoverRadius: 6,
                        }]
                    },
                    options: {
                        ...doughnutRadarChartOptions,
                        scales: {
                            r: {
                                angleLines: { color: 'rgba(255, 255, 255, 0.15)' },
                                grid: { color: 'rgba(255, 255, 255, 0.15)' },
                                pointLabels: { color: '#e0e0e0', font: {size: 10, family: 'Inter, Arial, sans-serif'} }, // smaller font for radar labels
                                ticks: { 
                                    color: '#b0b0c0', 
                                    backdropColor: 'transparent', 
                                    stepSize: 20, 
                                    font: {size: 10}
                                }
                            }
                        },
                        elements: { line: { borderWidth: 2 } } 
                    }
                });
            }
            
            // Cost per KM chart
            const costPerKmCtx = document.getElementById('costPerKmChart')?.getContext('2d');
            if(costPerKmCtx) {
                const oldCostPerKm = oldDataParsed.map(d => d['distance(m)'] > 0 ? (d.cost / (d['distance(m)']/1000)) : 0);
                const optimizedCostPerKm = optimizedDataParsed.map(d => d['distance(m)'] > 0 ? (d.cost / (d['distance(m)']/1000)) : 0);
                new Chart(costPerKmCtx, {
                    type: 'bar',
                    data: {
                        labels: commonTripLabels,
                        datasets: [{
                            label: 'Ancien Système Coût/km (TND)',
                            data: oldCostPerKm.map(val => val.toFixed(3)),
                            backgroundColor: 'rgba(255, 193, 7, 0.7)', 
                            borderColor: '#ffc107',
                            borderWidth: 1
                        }, {
                            label: 'Système Optimisé Coût/km (TND)',
                            data: optimizedCostPerKm.map(val => val.toFixed(3)),
                            backgroundColor: 'rgba(139, 195, 74, 0.7)', 
                            borderColor: '#8bc34a',
                            borderWidth: 1
                        }]
                    },
                    options: defaultChartOptions
                });
            }

            // Projection Charts
            const projectionCtx = document.getElementById('projectionChart')?.getContext('2d');
            if (projectionCtx && oldMetrics.count > 0 && optimizedMetrics.count > 0) {
                const actualDailySavings = (oldMetrics.totalCost - optimizedMetrics.totalCost); 

                const projectionData = {
                    weekly: actualDailySavings * 6,  // 6 days a week
                    monthly: actualDailySavings * 25, // 25 days a month
                    yearly: actualDailySavings * 312  // 312 days a year
                };

                document.getElementById('weeklyProjection').textContent = `${projectionData.weekly.toFixed(2)} TND`;
                document.getElementById('monthlyProjection').textContent = `${projectionData.monthly.toFixed(2)} TND`;
                document.getElementById('yearlyProjection').textContent = `${projectionData.yearly.toFixed(2)} TND`;
                
                const yearlyCO2Savings = (oldMetrics.totalCO2 - optimizedMetrics.totalCO2) * 312; // 312 days a year
                document.getElementById('yearlyCO2Projection').textContent = `${yearlyCO2Savings.toFixed(2)}kg`;
                const monthlyCO2Savings = (oldMetrics.totalCO2 - optimizedMetrics.totalCO2) * 25; // 312 days a year
                document.getElementById('monthlyCO2Projection').textContent = `${monthlyCO2Savings.toFixed(2)}kg`;
                const oldCostSeries = [0];
                const optimizedCostSeries = [0];
                // Time points: Week 1 (6d), Week 2 (12d), Week 3 (18d), Month 1 (25d), Month 2 (50d), Month 3 (75d), Month 6 (150d), Year 1 (312d)
                const timePoints = [6, 12, 18, 25, 50, 75, 150, 312]; 
                const projectionLabels = ['Départ', 'Semaine 1', 'Semaine 2', 'Semaine 3', 'Mois 1', 'Mois 2', 'Mois 3', 'Mois 6', 'An 1'];


                timePoints.forEach((days) => {
                    // Assuming the provided CSV data represents a single day's worth of trips for projection basis
                    oldCostSeries.push(oldMetrics.totalCost * days); 
                    optimizedCostSeries.push(optimizedMetrics.totalCost * days);
                });
                // The projectionLabels has 9 items, oldCostSeries and optimizedCostSeries should also have 9 items (including the initial 0).
                // The loop adds 8 items, so with the initial 0, it's 9. Correct.

                new Chart(projectionCtx, {
                    type: 'line',
                    data: {
                        labels: projectionLabels,
                        datasets: [{
                            label: 'Coût Acc. Projeté Ancien Sys. (TND)',
                            data: oldCostSeries,
                            borderColor: '#e91e63', 
                            backgroundColor: 'rgba(233, 30, 99, 0.1)',
                            tension: 0.2,
                            fill: true
                        }, {
                            label: 'Coût Acc. Projeté Sys. Optimisé (TND)',
                            data: optimizedCostSeries,
                            borderColor: '#2196f3', 
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            tension: 0.2,
                            fill: true
                        }]
                    },
                    options: defaultChartOptions
                });
            }

            // Environmental Impact Chart
            const environmentCtx = document.getElementById('environmentChart')?.getContext('2d');
            if (environmentCtx && oldMetrics.count > 0 && optimizedMetrics.count > 0) {
                const dailyCO2Savings = oldMetrics.totalCO2 - optimizedMetrics.totalCO2; 
                new Chart(environmentCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Journalier', 'Hebdomadaire (6j)', 'Mensuel (25j)', 'Annuel (312j)'],
                        datasets: [{
                            label: 'Économies de CO₂ Projetées (kg)',
                            data: [dailyCO2Savings, dailyCO2Savings * 6, dailyCO2Savings * 25, dailyCO2Savings * 312],
                            backgroundColor: 'rgba(76, 175, 80, 0.75)', 
                            borderColor: '#4caf50',
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                     options: {...defaultChartOptions, scales: {...defaultChartOptions.scales, x: { grid: { display: false } } } }
                });
            }
            // Distribution Chart (Histogram of Distances for Optimized System)
            const distributionCtx = document.getElementById('distributionChart')?.getContext('2d');
            if (distributionCtx && optimizedDataParsed.length > 0) {
                const distances = optimizedDataParsed.map(row => row['distance(m)']);
                const minDistance = Math.min(...distances);
                const maxDistance = Math.max(...distances);
                const binCount = 10;
                const binSize = (maxDistance - minDistance) > 0 ? (maxDistance - minDistance) / binCount : 1; // Avoid division by zero if all distances are same
                const bins = Array(binCount).fill(0);
                const binLabels = [];

                for (let i = 0; i < binCount; i++) {
                    const binStart = minDistance + i * binSize;
                    const binEnd = minDistance + (i + 1) * binSize;
                    binLabels.push(`${Math.round(binStart)}-${Math.round(binEnd)}m`);
                }

                distances.forEach(d => {
                    let binIndex = binSize > 0 ? Math.floor((d - minDistance) / binSize) : 0;
                    if (binIndex >= binCount) binIndex = binCount - 1; 
                    if (binIndex < 0) binIndex = 0; 
                    bins[binIndex]++;
                });
                
                new Chart(distributionCtx, {
                    type: 'bar',
                    data: {
                        labels: binLabels,
                        datasets: [{
                            label: 'Distribution Distances Trajets Sys. Optimisé',
                            data: bins,
                            backgroundColor: 'rgba(156, 39, 176, 0.7)', 
                            borderColor: '#9c27b0',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        ...defaultChartOptions,
                         scales: {
                            ...defaultChartOptions.scales,
                            x: { ...defaultChartOptions.scales.x, title: { display: true, text: 'Plages de Distance (m)', color: '#e0e0e0'}},
                            y: { ...defaultChartOptions.scales.y, title: { display: true, text: 'Nombre de Trajets', color: '#e0e0e0'}}
                        }
                    }
                });
            }

            // Trend Chart (Cost Savings per Trip)
            const trendCtx = document.getElementById('trendChart')?.getContext('2d');
            if (trendCtx && oldDataParsed.length === optimizedDataParsed.length && oldDataParsed.length > 0) {
                const costSavingsPerTrip = oldDataParsed.map((oldRow, i) => oldRow.cost - optimizedDataParsed[i].cost);
                new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: commonTripLabels,
                        datasets: [{
                            label: 'Économies de Coût par Trajet (TND)',
                            data: costSavingsPerTrip,
                            borderColor: '#009688', 
                            backgroundColor: 'rgba(0, 150, 136, 0.2)',
                            tension: 0.3,
                            fill: true,
                            pointRadius: 4,
                            pointHoverRadius: 7
                        }]
                    },
                    options: {
                        ...defaultChartOptions,
                        scales: {
                             ...defaultChartOptions.scales,
                            y: { ...defaultChartOptions.scales.y, title: { display: true, text: 'Économies (TND)', color: '#e0e0e0'}}
                        }
                    }
                });
            }
        }

        // Populate Performance Table
        function populatePerformanceTable() {
            const tableBody = document.getElementById('performanceTableBody');
            if (!tableBody) return;
            tableBody.innerHTML = ''; 

            if (oldMetrics.count === 0 || optimizedMetrics.count === 0) {
                 tableBody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 20px; color: #aaa;">Pas assez de données pour la comparaison.</td></tr>';
                return;
            }

            const metricsToDisplay = [
                { label: 'Distance Moyenne (m)', old: oldMetrics.avgDistance, new: optimizedMetrics.avgDistance, unit: 'm', higherIsBetter: false, fixed: 0 },
                { label: 'Temps Moyen (s)', old: oldMetrics.avgTime, new: optimizedMetrics.avgTime, unit: 's', higherIsBetter: false, fixed: 1 },
                { label: 'Temps Moyen (min)', old: oldMetrics.avgTime / 60, new: optimizedMetrics.avgTime / 60, unit: 'min', higherIsBetter: false, fixed: 2 },
                { label: 'Carburant Total (gpl)', old: oldMetrics.totalFuel, new: optimizedMetrics.totalFuel, unit: 'gpl', higherIsBetter: false, fixed: 2 },
                { label: 'CO₂ Total (kg)', old: oldMetrics.totalCO2, new: optimizedMetrics.totalCO2, unit: 'kg', higherIsBetter: false, fixed: 2 },
                { label: 'Coût Total (TND)', old: oldMetrics.totalCost, new: optimizedMetrics.totalCost, unit: 'TND', higherIsBetter: false, fixed: 2 },
                { label: 'Coût Moyen par Trajet (TND)', old: oldMetrics.avgCost, new: optimizedMetrics.avgCost, unit: 'TND', higherIsBetter: false, fixed: 2 },
                { 
                    label: 'Coût Moyen par km (TND/km)', 
                    old: oldMetrics.totalDistance > 0 ? oldMetrics.totalCost / (oldMetrics.totalDistance / 1000) : 0, 
                    new: optimizedMetrics.totalDistance > 0 ? optimizedMetrics.totalCost / (optimizedMetrics.totalDistance / 1000) : 0, 
                    unit: 'TND/km', 
                    higherIsBetter: false, 
                    fixed: 3 
                },
            ];

            metricsToDisplay.forEach(metric => {
                const improvement = metric.old - metric.new;
                let percentageChange = 0;
                if (metric.old !== 0) {
                     percentageChange = (improvement / Math.abs(metric.old)) * 100;
                } else if (metric.new !== 0) { 
                    percentageChange = metric.new > 0 ? -Infinity : Infinity; 
                }

                const row = tableBody.insertRow();
                row.insertCell().textContent = metric.label;
                row.insertCell().textContent = `${metric.old.toFixed(metric.fixed)}${metric.unit === 'TND' || metric.unit === 'TND/km' ? '' : ' '}${metric.unit}`;
                row.insertCell().textContent = `${metric.new.toFixed(metric.fixed)}${metric.unit === 'TND' || metric.unit === 'TND/km' ? '' : ' '}${metric.unit}`;
                
                const improvementCell = row.insertCell();
                improvementCell.textContent = `${improvement.toFixed(metric.fixed)}${metric.unit === 'TND' || metric.unit === 'TND/km' ? '' : ' '}${metric.unit}`;
                improvementCell.style.color = improvement >= 0 ? '#00ff64' : '#ff0050';

                const percentageCell = row.insertCell();
                if (isFinite(percentageChange)) {
                    percentageCell.textContent = `${percentageChange.toFixed(1)}%`;
                } else {
                     percentageCell.textContent = percentageChange > 0 ? "∞ %" : "-∞ %";
                }
                percentageCell.style.color = percentageChange >= 0 ? '#00ff64' : '#ff0050';
            });
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            try {
                oldDataParsed = parseCSV(oldDataCSV);
                optimizedDataParsed = parseCSV(optimizedDataCSV);

                if(oldDataParsed.length === 0 && optimizedDataParsed.length === 0) {
                    console.error("Échec de l'analyse des données CSV. Le tableau de bord sera vide.");
                    const container = document.querySelector('.container');
                    if (container) {
                        container.innerHTML = `<div style="padding: 50px; text-align: center; color: #ff8080; font-size: 1.2em;">
                                                <h1>Erreur</h1>
                                                <p>Impossible de charger ou d'analyser les données nécessaires pour afficher le tableau de bord.</p>
                                                <p>Veuillez vérifier la console pour plus de détails et vous assurer que les données CSV sont correctement formatées et intégrées.</p>
                                              </div>`;
                    }
                    return; 
                }

                oldMetrics = calculateMetrics(oldDataParsed);
                optimizedMetrics = calculateMetrics(optimizedDataParsed);

                updateOverviewMetrics();
                createCharts();
                populatePerformanceTable();
                navigateToPage('overview', document.querySelector('.nav-item.active')); 
            } catch (error) {
                console.error("Erreur lors de l'initialisation du tableau de bord:", error);
                const container = document.querySelector('.container');
                if (container) {
                    container.innerHTML = `<div style="padding: 50px; text-align: center; color: #ff8080; font-size: 1.2em;">
                                            <h1>Erreur d'Initialisation</h1>
                                            <p>Une erreur inattendue s'est produite lors de la configuration du tableau de bord.</p>
                                            <p>Détails : ${error.message}</p>
                                            <p>Veuillez consulter la console pour plus d'informations.</p>
                                          </div>`;
                }
            }
        });

    </script>
</body>
</html>
